# ТЗ

## Цель работы
Написать три Ansible-плейбука для автоматизации типичных DevOps-задач: настройка веб-сервера, деплой приложения и настройка мониторинга.


- Используем 1-3 виртуальные машины (пользуемся скриптами, которые в этой же репе лежат)

## Структура проекта
```
ansible-practice/
├── inventory/
│   └── hosts.ini
├── playbooks/
│   ├── 1-webserver-setup.yml
│   ├── 2-app-deploy.yml
│   └── 3-monitoring-setup.yml
├── roles/ (опционально)
└── README.md
```

---

## Плейбук 1: Настройка веб-сервера (webserver-setup.yml)

### Задача
Подготовить сервер для работы веб-приложения: установить nginx, настроить firewall, создать пользователя для приложения.

### Требования
1. Обновить кэш пакетов apt
2. Установить пакеты: nginx, ufw, python3-pip
3. Создать пользователя `appuser` с домашней директорией
4. Создать директорию `/var/www/myapp` с правами для `appuser`
5. Настроить UFW:
   - Разрешить SSH (порт 22)
   - Разрешить HTTP (порт 80)
   - Включить firewall
6. Скопировать базовый конфиг nginx из template или файла:
   - Настроить server block для домена `myapp.local`
   - Document root: `/var/www/myapp`
   - Включить логирование
7. Запустить nginx и добавить в автозагрузку
8. Проверить, что nginx отвечает (можно через uri module или command)

### Использовать переменные 
- `app_user: appuser`
- `app_directory: /var/www/myapp`
- `domain_name: myapp.local`

---

## Плейбук 2: Деплой приложения (app-deploy.yml)

### Задача
Развернуть простое веб-приложение (например, статический сайт или простое Flask-приложение).

### Требования
1. Создать простое Flask-приложение или использовать статический HTML
2. Скопировать файлы приложения в `/var/www/myapp/`
3. Если Flask-приложение:
   - Установить Flask через pip
   - Создать systemd service для запуска приложения
   - Настроить nginx как reverse proxy к приложению (порт 5000)
4. Если статический сайт:
   - Скопировать index.html и другие файлы
   - Убедиться, что права на файлы корректные (owner: appuser)
5. Перезагрузить nginx для применения изменений
6. Использовать handlers для перезагрузки сервисов (только при изменениях)

### Что должно получиться
- Приложение доступно по адресу `http://server_ip/`
- Логи приложения пишутся в `/var/log/myapp/`

### Переменные
- `app_version: 1.0` (для тегирования версии)
- `app_port: 5000` (если Flask)

---

## Плейбук 3: Настройка мониторинга (monitoring-setup.yml)

### Задача
Установить и настроить Node Exporter для сбора метрик сервера.

### Требования
1. Скачать Node Exporter (последняя версия с GitHub releases)
2. Распаковать в `/opt/node_exporter/`
3. Создать systemd service для Node Exporter:
   - Запуск от пользователя `node_exporter` (создать)
   - Порт по умолчанию 9100
   - Автозапуск при старте системы
4. Настроить UFW - открыть порт 9100 (только для конкретного IP Prometheus-сервера, если есть)
5. Запустить Node Exporter
6. Проверить доступность метрик: `curl localhost:9100/metrics`

### Дополнительно (опционально)
- Установить и настроить filebeat для отправки логов nginx
- Настроить logrotate для логов приложения

### Переменные
- `node_exporter_version: 1.7.0`
- `prometheus_server_ip: 192.168.1.100` (для firewall)

---

## Проверка работы

После выполнения всех плейбуков должно работать:
- `curl http://server_ip/` - отдает приложение
- `curl http://server_ip:9100/metrics` - отдает метрики
- `systemctl status nginx` - nginx активен
- `systemctl status node_exporter` - node_exporter активен