# Задание 1: Создание Dockerfile

## Цель задания

Написать полноценный Dockerfile для Python Flask-приложения, собрать Docker-образ и запустить контейнер.

---

## Техническое задание

### 1. Базовый образ

Использовать официальный образ Python: python:3.11-slim

### 2. Метаданные образа

Добавить метаинформацию об образе:

LABEL maintainer="кто владелец образа - кто угодно: почта, никнейм, че хотите"
LABEL description="любое описание приложения"
LABEL version="1.0.0"

### 3. Создание пользователя

**Требование**: Приложение должно работать от непривилегированного пользователя.

Создать пользователя с UID 1001

**Важно**: Директива должна быть ПОСЛЕ всех операций, требующих root-привилегий (установка пакетов, создание директорий, копирование файлов), но ПЕРЕД командой `CMD`.

### 4. Рабочая директория

Установить рабочую директорию: /app

### 5. Переменные окружения

Необходимо объявить следующие переменные окружения:

PYTHONDONTWRITEBYTECODE=1
PYTHONUNBUFFERED=1
APP_VERSION=1.0.0
ENVIRONMENT= (env/prod че хотите)
STUDENT_NAME=(че хотите)

### 6. Установка зависимостей

#### 6.1 Копирование файла зависимостей

Скопировать `requirements.txt` в контейне

#### 6.2 Установка системных библиотек и Python-пакетов

Установить необходимые системные пакеты и Python-зависимости. Помните про объединение команд ран в одну

**Че нам надо сделать:**
- `apt-get update` - обновляет списки пакетов
- `apt-get install -y --no-install-recommends gcc` - устанавливает компилятор gcc (нужен для сборки некоторых Python-пакетов)
- `pip install --no-cache-dir --upgrade pip` - обновляет pip без кэширования
- `pip install --no-cache-dir -r requirements.txt` - устанавливает зависимости из файла без кэширования
- `apt-get purge -y --auto-remove gcc` - удаляет gcc после установки
- `apt-get clean` - очищает кэш apt
- `rm -rf /var/lib/apt/lists/*` - удаляет списки пакето

### 7. Копирование исходного кода

Скопировать Python-скрипт в рабочую директорию

### 8. Изменение владельца файлов

Передать права на файлы пользователю с UID 1001 (chown -R 1001:1001 /app)

**Важно**: Эта команда должна идти ПОСЛЕ копирования всех файлов, но ПЕРЕД директивой `USER 1001`.

### 9. Переключение на непривилегированного пользователя

После всех операций, требующих root-привилегий, переключиться на не рута

### 10. Открытие порта

Документируем порт 8080, что будем работать на нем

### 11. Health Check

Добавить проверку работоспособности контейнера:

```dockerfile
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
    CMD python -c "import urllib.request; urllib.request.urlopen('http://localhost:8080/health')" || exit 1
```

**Параметры HEALTHCHECK:**
- `--interval=30s` - интервал между проверками (каждые 30 секунд)
- `--timeout=3s` - таймаут на выполнение команды проверки (3 секунды)
- `--start-period=5s` - период инициализации контейнера (5 секунд)
- `--retries=3` - количество неудачных попыток до признания контейнера нездоровым

**Команда проверки**: Выполняет HTTP-запрос к эндпоинту `/health` приложения.

### 12. Команда запуска (CMD)

Определить команду запуска приложения: python app.py

### Дальше соберите образ

### Потом запустите контейнер на порту 8080 хоста

### Проверьте работу, http://localhost:8080/, docker ps